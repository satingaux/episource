name: Create Release
on:
  push:
    branches: [ main ]
jobs:
  build:
    name: Create Release
    runs-on: ubuntu-latest
    steps:
      - name: Checkout master or main
        uses: actions/checkout@v2 # actions/checkout@main
      
      - uses: oprypin/find-latest-tag@v1
        with:
          repository: satingaux/episource  # The repository to scan.
          releases-only: true  # We know that all relevant tags have a GitHub release for them.
        id: lastVersion  # The step ID to refer to later.

      - name: Read current_version from version.ini file
        id: currentVersion
        uses: juliangruber/read-file-action@v1
        with:
          path: ./version.ini
        env:
          CURRENT_VERSION: ${{ steps.currentVersion.outputs.content }}
          LAST_VERSION:  ${{ steps.lastVersion.outputs.tag }}  #0.0 default if statement
      - run: |
          echo "last version ${{ steps.lastVersion.outputs.tag }}"
          echo "current version ${{ steps.currentVersion.outputs.content }}"
          echo "last version $LAST_VERSION"
          echo "current version $CURRENT_VERSION"
          
      - name: is last version exists
        id: isLastVersionNull
        if: ${{ steps.lastVersion.outputs.tag }} == ${{ null }}
        run: $last_version = ${{ 0.0 }}
        continue-on-error: true

#       - name: compare new and old version
#         id: compare_versions
#         if: $current_version == $last_version
#         run: |
#           echo "Current Version is equal to last version, So no version update and no release as well"
#           exit 1

        
        
        
      - name: Create Release
        id: create_release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} # This token is provided by Actions, you do not need to create your own token
        with:
          tag_name: 1.2
          release_name: Release ${{ github.ref }}
          body: |
            Changes in this Release2
            - First Change
            - Second Change
          draft: false
          prerelease: false
